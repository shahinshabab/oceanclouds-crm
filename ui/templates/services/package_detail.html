{% extends "ui/base.html" %}
{% load roles_tags %}

{% block title %}Package – {{ package.name }}{% endblock %}

{% block content %}
{% is_admin as is_admin %}
{% is_manager as is_manager %}
{% is_employee as is_employee %}

<div class="container py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-semibold mb-1">{{ package.name }}</h2>
      {% if package.code %}
        <div class="text-muted small">Code: {{ package.code }}</div>
      {% endif %}
      {% if package.is_active %}
        <span class="badge bg-success mt-1">Active</span>
      {% else %}
        <span class="badge bg-secondary mt-1">Inactive</span>
      {% endif %}
    </div>

    {% if is_admin or is_manager %}
      <a href="{% url 'services:package_update' package.pk %}" class="btn btn-primary btn-sm">
        Edit Package
      </a>
    {% endif %}
  </div>

  <!-- Summary -->
  <div class="card mb-3">
    <div class="card-body">
      <div class="row gy-3">
        <div class="col-md-4">
          <div class="text-uppercase text-muted small">Total price</div>
          <div class="fw-semibold">
            {{ package.total_price }}
          </div>
        </div>
        <div class="col-12">
          <div class="text-uppercase text-muted small">Description</div>
          <div>
            {% if package.description %}
              {{ package.description|linebreaksbr }}
            {% else %}
              <span class="text-muted">—</span>
            {% endif %}
          </div>
        </div>
        <div class="col-12">
          <div class="text-uppercase text-muted small">Notes</div>
          <div>
            {% if package.notes %}
              {{ package.notes|linebreaksbr }}
            {% else %}
              <span class="text-muted">—</span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Package items -->
  <div class="card mb-4">
    <div class="card-header">
      <span class="fw-semibold small text-uppercase text-muted">Package Items</span>
    </div>
    <div class="card-body p-0">
      {% if package.items.all %}
        <table class="table table-sm mb-0 align-middle">
          <thead class="table-light">
          <tr>
            <th>Service / Description</th>
            <th class="text-end">Qty</th>
            <th class="text-end">Unit price</th>
            <th class="text-end">Line total</th>
          </tr>
          </thead>
          <tbody>
          {% for item in package.items.all %}
            <tr>
              <td>
                {% if item.service %}
                  <div class="fw-semibold">
                    <a href="{% url 'services:service_detail' item.service.pk %}">
                      {{ item.service.name }}
                    </a>
                  </div>
                {% endif %}
                <div class="text-muted small">{{ item.description }}</div>
              </td>
              <td class="text-end">{{ item.quantity }}</td>
              <td class="text-end">{{ item.unit_price }}</td>
              <td class="text-end">{{ item.line_total }}</td>
            </tr>
          {% endfor %}
          </tbody>
          <tfoot>
          <tr>
            <th colspan="3" class="text-end">Total</th>
            <th class="text-end fw-semibold">
              {{ package.total_price }}
            </th>
          </tr>
          </tfoot>
        </table>
      {% else %}
        <p class="text-muted mb-0 p-3">No items added to this package.</p>
      {% endif %}
    </div>
  </div>

  <!-- Actions -->
  <div class="text-center">
    <a href="{% url 'services:package_list' %}" class="btn btn-outline-secondary me-2">
      Back to Packages
    </a>
    {% if is_admin or is_manager %}
      <a href="{% url 'services:package_update' package.pk %}" class="btn btn-primary">
        Edit Package
      </a>
    {% endif %}
  </div>

</div>
{% endblock %}
