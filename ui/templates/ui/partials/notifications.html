{# ui/partials/notifications.html #}
<div class="position-relative">
  <!-- Bell icon -->
  <button id="notificationToggle" class="icon-btn position-relative" type="button">
    <i class="bi bi-bell"></i>

    {% if notifications %}
      <span
        class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle"
        style="font-size: 0.5rem;"
      ></span>
    {% endif %}
  </button>

  <div id="notificationDropdown" class="dropdown-panel d-none" style="min-width: 320px;">
    <div class="dropdown-header d-flex justify-content-between align-items-center mb-1">
      <span>Notifications</span>
      {% if notifications %}
        <span class="badge bg-dark-subtle text-dark-emphasis">
          {{ notifications|length }}
        </span>
      {% endif %}
    </div>

    {% if notifications %}
      <div class="small" style="max-height: 360px; overflow-y: auto;">
        {% for note in notifications %}
          {% if not note.is_read %}
            <div class="border rounded-3 px-2 py-2 mb-1 bg-light-subtle"
                 data-notif-id="{{ note.id }}"
                 style="position: relative;">

              <a href="{{ note.get_target_url }}"
                 class="stretched-link text-decoration-none text-reset">
                <div class="fw-semibold small">
                  {{ note.message|default:note.get_notif_type_display }}
                </div>

                <div class="text-muted small mt-1">
                  {% if note.actor %}
                    {{ note.actor.get_full_name|default:note.actor.username }} &middot;
                  {% endif %}
                  {{ note.created_at|date:"M j, H:i" }}
                </div>
              </a>

              <div class="d-flex align-items-center mt-2" style="position: relative; z-index: 5;">
                <button type="button"
                        class="btn btn-sm btn-outline-secondary py-0 px-2 js-mark-notification-read"
                        data-id="{{ note.id }}"
                        data-url="{% url 'common:notification_mark_read' note.id %}">
                  Mark as read
                </button>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% else %}
      <div class="small text-muted mt-1">
        You're all caught up. No unread notifications.
      </div>
    {% endif %}

    <!-- Always-visible footer -->
    <div class="border-top mt-2 pt-2 text-center">
      <a href="{% url 'common:notification_list' %}"
         class="btn btn-link btn-sm text-decoration-none">
        View all notifications
      </a>
    </div>
  </div>
</div>
