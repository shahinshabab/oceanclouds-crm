{% extends "ui/base.html" %}
{% load roles_tags %}
{% block title %}Payment – {{ payment.invoice.number }}{% endblock %}

{% block content %}
{% is_admin as is_admin %}
{% is_manager as is_manager %}
{% is_employee as is_employee %}

<div class="container py-4">

  <!-- Header -->
  <div class="mb-3">
    <h1 class="h4 mb-1">Payment {{ payment.amount }}</h1>
    <div class="small text-muted">
      Invoice {{ payment.invoice.number }} &middot; {{ payment.date }}
    </div>
  </div>

  <!-- Main Details Card -->
  <div class="card mb-3">
    <div class="card-body">
      <div class="row g-3">

        <div class="col-md-4">
          <div class="text-uppercase text-muted small mb-1">Invoice</div>
          <div class="fw-semibold">
            <a href="{% url 'sales:invoice_detail' payment.invoice.pk %}">
              {{ payment.invoice.number }}
            </a>
          </div>
        </div>

        <div class="col-md-4">
          <div class="text-uppercase text-muted small mb-1">Client</div>
          <div class="fw-semibold">
            {{ payment.invoice.deal.client }}
          </div>
        </div>

        <div class="col-md-4">
          <div class="text-uppercase text-muted small mb-1">Date</div>
          <div class="fw-semibold">
            {{ payment.date }}
          </div>
        </div>

        <div class="col-md-4">
          <div class="text-uppercase text-muted small mb-1">Amount</div>
          <div class="fw-bold fs-5">
            {{ payment.amount }}
          </div>
        </div>

        <div class="col-md-4">
          <div class="text-uppercase text-muted small mb-1">Payment Type</div>
          <div class="fw-semibold">
            {% if payment.payment_type %}
              {{ payment.get_payment_type_display }}
            {% else %}
              <span class="text-muted">—</span>
            {% endif %}
          </div>
        </div>

        <div class="col-md-4">
          <div class="text-uppercase text-muted small mb-1">Method</div>
          <div class="fw-semibold">
            {{ payment.get_method_display }}
          </div>
        </div>

        <div class="col-md-4">
          <div class="text-uppercase text-muted small mb-1">Reference</div>
          <div class="fw-semibold">
            {% if payment.reference %}
              {{ payment.reference }}
            {% else %}
              <span class="text-muted">—</span>
            {% endif %}
          </div>
        </div>

        <div class="col-md-4">
          <div class="text-uppercase text-muted small mb-1">Received By</div>
          <div class="fw-semibold">
            {% if payment.received_by %}
              {{ payment.received_by }}
            {% else %}
              <span class="text-muted">—</span>
            {% endif %}
          </div>
        </div>

        <!-- Notes full width -->
        <div class="col-12 mt-2">
          <div class="text-uppercase text-muted small mb-1">Notes</div>
          <div>
            {% if payment.notes %}
              {{ payment.notes|linebreaksbr }}
            {% else %}
              <span class="text-muted">No notes.</span>
            {% endif %}
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Action Row -->
  <div class="text-center">
    {% if is_admin or is_manager %}
      <a href="{% url 'sales:payment_update' payment.pk %}" class="btn btn-primary me-2">
        Edit Payment
      </a>
    {% endif %}
    <a href="{% url 'sales:payment_list' %}" class="btn btn-outline-secondary">
      Back to Payments
    </a>
  </div>

</div>
{% endblock %}
