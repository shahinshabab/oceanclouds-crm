{% extends "ui/base.html" %}
{% load roles_tags %}

{% block title %}Contact – {{ contact.first_name }} {{ contact.last_name }}{% endblock %}

{% block content %}
{% is_admin request.user as is_admin %}
{% is_manager request.user as is_manager %}
{% is_employee request.user as is_employee %}

<div class="container py-3">

  <!-- Page header -->
  <div class="mb-4 d-flex justify-content-between align-items-start">
    <div>
      <h2 class="fw-semibold mb-1">
        {{ contact.first_name }} {{ contact.last_name }}
      </h2>
      {% if contact.role %}
        <span class="badge bg-secondary me-1">{{ contact.get_role_display }}</span>
      {% endif %}
      {% if contact.is_primary %}
        <span class="badge bg-success">Primary Contact</span>
      {% endif %}
    </div>
  </div>

  <!-- Details card -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">

      <!-- Row 1 -->
      <div class="row mb-3">
        <div class="col-md-4 mb-3 mb-md-0">
          <div class="text-muted small text-uppercase">Client</div>
          <div class="fw-semibold mt-1">
            {% if contact.client %}
              <a href="{% url 'crm:client_detail' contact.client.pk %}" class="text-decoration-none">
                {{ contact.client }}
              </a>
            {% else %}
              <span class="text-muted">—</span>
            {% endif %}
          </div>
        </div>

        <div class="col-md-4 mb-3 mb-md-0">
          <div class="text-muted small text-uppercase">Role</div>
          <div class="fw-semibold mt-1">
            {{ contact.get_role_display|default:"—" }}
          </div>
        </div>

        <div class="col-md-4">
          <div class="text-muted small text-uppercase">Primary Contact</div>
          <div class="fw-semibold mt-1">
            {% if contact.is_primary %}
              <span class="badge bg-success">Yes</span>
            {% else %}
              <span class="text-muted">No</span>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Row 2 -->
      <div class="row mb-3">
        <div class="col-md-4 mb-3 mb-md-0">
          <div class="text-muted small text-uppercase">Email</div>
          <div class="fw-semibold mt-1">
            {% if contact.email %}
              <a href="mailto:{{ contact.email }}">{{ contact.email }}</a>
            {% else %}
              <span class="text-muted">—</span>
            {% endif %}
          </div>
        </div>

        <div class="col-md-4 mb-3 mb-md-0">
          <div class="text-muted small text-uppercase">Phone</div>
          <div class="fw-semibold mt-1">
            {{ contact.phone|default:"—" }}
          </div>
        </div>

        <div class="col-md-4">
          <div class="text-muted small text-uppercase">WhatsApp</div>
          <div class="fw-semibold mt-1">
            {{ contact.whatsapp|default:"—" }}
          </div>
        </div>
      </div>

      <!-- Row 3: Notes full width -->
      <div class="row mb-3">
        <div class="col-12">
          <div class="text-muted small text-uppercase">Notes</div>
          <div class="mt-1">
            {{ contact.notes|linebreaks|default:"<span class='text-muted'>—</span>"|safe }}
          </div>
        </div>
      </div>

      <!-- Row 4: Actions -->
      <div class="row">
        <div class="col-12 d-flex justify-content-center gap-2 mt-2">
          {% if is_admin or is_manager %}
            <a href="{% url 'crm:contact_update' contact.pk %}"
               class="btn btn-primary px-4">
              Edit
            </a>
          {% endif %}

          {% if contact.client %}
            <a href="{% url 'crm:client_detail' contact.client.pk %}"
               class="btn btn-outline-secondary">
              Back to Client
            </a>
          {% else %}
            <a href="{% url 'crm:contact_list' %}"
               class="btn btn-outline-secondary">
              Back to Contacts
            </a>
          {% endif %}
        </div>
      </div>

    </div>
  </div>

</div>
{% endblock %}
